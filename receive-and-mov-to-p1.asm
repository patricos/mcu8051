;****************
;SERIAL TRANSMISSION RECEIVER FOR 8051 (89c2051)
;PATRYK MAZURKIEWICZ
;2023-27th-April
;****************

;TIMER 0 SETTINGS
T0_G	EQU	0	;GATE			0: TRx, NOT THE INTx
T0_C	EQU	0	;COUNTER/-TIMER		0: TIMER
T0_M	EQU	0	;MODE (0..3)		0: 8 BIT
TIM0	EQU	T0_M+T0_C*4+T0_G*8

;TIMER 1 SETTINGS
T1_G	EQU	0	;GATE			0: TRx, NOT THE INTx
T1_C	EQU	0	;COUNTER/-TIMER		0: TIMER
T1_M	EQU	2	;MODE (0..3)		2: 16 BIT
TIM1	EQU	T1_M+T1_C*4+T1_G*8

TMOD_SET	EQU	TIM0+TIM1*16

;SERIAL TRANSMISSION
TR_M	EQU	1	;MODE (1..3)
TR_R	EQU	1	;RECEIVE ENABLE

SCON_SET	EQU	TR_M*64+TR_R*16

;SMOD=1
;TIMER1=57600/300 BOD = 192
TH1_SET	EQU	256-192
TL1_SET	EQU	256-192

ORG 0H

MOV	P1,	#0	;INITIALIZE PORT P1
MOV	SCON,	#SCON_SET
ORL	PCON,	#80H	;SMOD=1
MOV	TMOD,	#TMOD_SET
MOV	TH1,	#TH1_SET
MOV	TL1,	#TL1_SET
SETB	TR1		;TIMER1 START

LOOP:
JNB	RI,	$	;WAITING FOR RECEIVING
;			;JUMP IF ZERO
CLR	RI
;			;MOV	A,	SBUF	;GET THE CHAR THAT WAS SENT
;			;MOV	P1,	A	;AND WRITE THAT SOMEWHERE!
MOV	SBUF,	P1	;DISPAY THAT BYTE IN LEDS
;			;(IS THE ABOVE THE 2-CYCLE "MOV DIRECT,DIRECT"?)
SJMP	LOOP
